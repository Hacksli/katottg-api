# KATOTTG API

REST API для пошуку по Кодифікатору адміністративно-територіальних одиниць та територій територіальних громад (КАТОТТГ) України.

## Опис

Сервіс надає HTTP API для повнотекстового пошуку населених пунктів України за назвою. Дані базуються на офіційному кодифікаторі Мінрегіону (редакція наказу від 19.01.2024 №48).

**Стек:** Go 1.24 + MySQL

## Запуск

### Docker

```bash
docker build -t katottg-api .
docker run -p 3000:80 katottg-api
```

### Локально

```bash
go mod download
go build -o server .
PORT=3000 ./server
```

Сервер автоматично підключається до бази та визначає таблицю.

## API

### `GET /?text={query}`

Пошук населених пунктів за текстом (LIKE %query%).

#### Параметри

| Параметр | Тип | Обов'язковий | За замовчуванням | Опис |
|-----------|------|:---:|:---------:|------|
| `text` | string | ✅ | — | Пошуковий запит (назва населеного пункту, району, області) |
| `page` | int | ❌ | 1 | Номер сторінки (починається з 1) |
| `pagelimit` | int | ❌ | 20 | Кількість результатів на сторінку (мін: 5, макс: 100) |

#### Відповідь

```json
{
  "foundRows": 10,
  "total": 86,
  "items": [
    {
      "id": 12374,
      "text": "обл.Київська, р-н.Обухівський, тг.Васильківська, м.Васильків",
      "code": "UA32120030010069648"
    }
  ],
  "links": [
    { "page": 1 },
    { "page": 2, "current": "true" },
    { "page": 3 },
    { "page": "..." },
    { "page": 9 }
  ],
  "filters": {
    "page": 2,
    "nextpage": 3
  }
}
```

#### Поля відповіді

| Поле | Тип | Опис |
|------|------|------|
| `foundRows` | int | Кількість записів на поточній сторінці |
| `total` | int | Загальна кількість знайдених записів |
| `items` | array | Масив знайдених записів |
| `items[].id` | int | ID запису в базі |
| `items[].text` | string | Повний шлях: `обл.X, р-н.Y, тг.Z, с.Назва` |
| `items[].code` | string | Код КАТОТТГ (UA + 17 цифр) |
| `links` | array | Панель пагінації (номери сторінок + "..." для скорочення) |
| `links[].page` | int/string | Номер сторінки або `"..."` |
| `links[].current` | string | `"true"` для поточної сторінки |
| `filters.page` | int | Поточна сторінка (1-based) |
| `filters.nextpage` | int/null | Наступна сторінка або `null` якщо остання |

#### Пагінація (links)

Панель навігації генерується за алгоритмом:

- **≤ 7 сторінок** — показуються всі сторінки з `current: "true"/"false"`
- **> 7 сторінок** — скорочений вигляд:
  - Перша сторінка
  - `"..."` якщо поточна далеко від початку
  - Попередня, поточна, наступна
  - `"..."` якщо поточна далеко від кінця
  - Остання сторінка

#### Приклади

**Простий пошук:**
```
GET /?text=Васильків
```

**Друга сторінка, 10 результатів:**
```
GET /?text=Васильків&page=2&pagelimit=10
```

**Помилка (без параметра text):**
```json
{
  "status": "error",
  "message": "text parameter required"
}
```

## Формат даних

Поле `text` містить ієрархічний шлях населеного пункту з префіксами:

| Префікс | Категорія | Рівень |
|---------|-----------|--------|
| `обл.` | Область (O) | 1 |
| `м.` | Місто спец. статусу (Київ, Севастополь) | 1 |
| `р-н.` | Район (P) | 2 |
| `тг.` | Територіальна громада (H) | 3 |
| `м.` | Місто (M) | 4 |
| `смт.` | Селище міського типу (T) | 4 |
| `с.` | Село (C) | 4 |
| `п.` | Селище (X) | 4 |

**Приклади:**
```
обл.Київська, р-н.Обухівський, тг.Васильківська, м.Васильків
обл.Дніпропетровська, р-н.Синельниківський, тг.Васильківська, смт.Письменне
м.Київ
м.Севастополь
```

## База даних

**Таблиця:** `mytable`

| Колонка | Тип | Опис |
|---------|------|------|
| `id` | int (PK, auto_increment) | Унікальний ідентифікатор |
| `text` | text | Повний шлях населеного пункту |
| `code` | varchar(19) | Код КАТОТТГ |

**Записів:** 31 747 (редакція 2024)

## Джерело даних

Кодифікатор затверджений наказом Міністерства розвитку громад та територій України від 26.11.2020 №290 (в редакції наказу від 19.01.2024 №48).

## Ліцензія

MIT
